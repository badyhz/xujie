<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Step 1 - å‡ºç”Ÿæ—¥æœŸ & 80é¢˜ç­”é¢˜ï¼ˆåªæ”¶é›†ï¼‰</title>
<style>
  :root{--bg:#f6f7fb;--card:#fff;--text:#222;--muted:#6c757d;--primary:#4dabf7;--ring:rgba(77,171,247,.25)}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:"Noto Sans SC",system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .container{max-width:1080px;margin:0 auto;padding:18px}
  h1{margin:6px 0 2px;font-size:22px}
  .sub{color:var(--muted);font-size:13px;margin-bottom:12px}
  .panel{background:var(--card);border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.06);padding:16px;margin:16px 0}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  input[type="date"]{padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;outline:none}
  input[type="date"]:focus{box-shadow:0 0 0 4px var(--ring);border-color:#cfe8ff}

  .q{padding:12px;border:1px solid #eef1f5;border-radius:12px;margin-bottom:12px;background:#fff}
  .q h4{margin:0 0 8px;font-size:14px;font-weight:600}
  .q .item{display:grid;grid-template-columns: 1fr 120px 48px;align-items:center;gap:12px}
  input[type=range]{width:100%}
  .val{width:48px;text-align:right;color:#111}

  .topline{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  .muted{color:var(--muted);font-size:12px}
  progress{width:220px;height:10px}
  .actions{position:sticky;bottom:0;background:linear-gradient(0deg,#fff,rgba(255,255,255,.96));border-top:1px solid #eee;display:flex;justify-content:space-between;align-items:center;padding:12px}
  button{padding:12px 18px;border:none;border-radius:10px;background:var(--primary);color:#fff;cursor:pointer}
  button.ghost{background:#e9ecef;color:#222}
</style>
</head>
<body>
  <div class="container">
    <h1>Step 1 Â· å‡ºç”Ÿæ—¥æœŸ & 80 é¢˜ç­”é¢˜</h1>
    <div class="sub">æœ¬é¡µä»…æ”¶é›†æ•°æ®ï¼›ä¸ä¼šå±•ç¤ºç»“æœã€‚åˆ†æ•°å°†ç”¨äº Step 2 ä¸æŠ¥å‘Šé¡µã€‚</div>

    <!-- åŸºç¡€ä¿¡æ¯ -->
    <section class="panel">
      <h2>âœ¨ åŸºç¡€ä¿¡æ¯</h2>
      <div class="row">
        <label for="birth">å‡ºç”Ÿæ—¥æœŸï¼š</label>
        <input id="birth" type="date"/>
        <span id="zodiacEcho" class="muted"></span>
      </div>
    </section>

    <!-- é¢˜ç›® -->
    <section class="panel">
      <div class="topline">
        <h2>ğŸ“ è‡ªè¯„é—®å·ï¼ˆ80 é¢˜ | 1=éå¸¸ä¸åŒæ„ Â·Â·Â· 5=éå¸¸åŒæ„ï¼‰</h2>
        <div class="row">
          <span class="muted">å·²è°ƒæ•´ï¼š<span id="movedCount">0</span>/80</span>
          <progress id="pg" max="80" value="0"></progress>
        </div>
      </div>
      <form id="quizForm"></form>
    </section>
  </div>

  <!-- åº•éƒ¨æ“ä½œ -->
  <div class="actions">
    <button class="ghost" onclick="location.href='step2.html'">è·³è¿‡ï¼ˆä»…æ¼”ç¤ºï¼‰</button>
    <div class="row">
      <span class="muted">å®Œæˆåä¿å­˜å¹¶è¿›å…¥ç¬¬äºŒæ­¥</span>
      <button id="saveNext">ä¿å­˜å¹¶è¿›å…¥ç¬¬äºŒæ­¥ âœ</button>
    </div>
  </div>

<script>
/* -------- æ˜Ÿåº§ / å››è±¡ / äº”è¡Œ -------- */
function zodiacFromDate(month, day){
  const names=["æ‘©ç¾¯åº§","æ°´ç“¶åº§","åŒé±¼åº§","ç™½ç¾Šåº§","é‡‘ç‰›åº§","åŒå­åº§","å·¨èŸ¹åº§","ç‹®å­åº§","å¤„å¥³åº§","å¤©ç§¤åº§","å¤©èåº§","å°„æ‰‹åº§"];
  const edge =[1222,120,219,321,420,521,622,723,823,923,1024,1123]; // MMDD
  const md = month*100+day; let idx=0; for(let i=0;i<edge.length;i++){ if(md>=edge[i]) idx=i; } return names[idx];
}
const zodiacElementMap = { // å››è±¡
  "ç™½ç¾Šåº§":"ç«","ç‹®å­åº§":"ç«","å°„æ‰‹åº§":"ç«",
  "é‡‘ç‰›åº§":"åœŸ","å¤„å¥³åº§":"åœŸ","æ‘©ç¾¯åº§":"åœŸ",
  "åŒå­åº§":"é£","å¤©ç§¤åº§":"é£","æ°´ç“¶åº§":"é£",
  "å·¨èŸ¹åº§":"æ°´","å¤©èåº§":"æ°´","åŒé±¼åº§":"æ°´"
};
function fiveElementFromYear(y){
  const stems = ["åºš","è¾›","å£¬","ç™¸","ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±"]; // year%10 ç®€åŒ–
  const s = stems[y%10];
  if("ç”²ä¹™".includes(s)) return "æœ¨";
  if("ä¸™ä¸".includes(s)) return "ç«";
  if("æˆŠå·±".includes(s)) return "åœŸ";
  if("åºšè¾›".includes(s)) return "é‡‘";
  return "æ°´"; // å£¬ç™¸
}
const birthEl = document.getElementById('birth');
birthEl.addEventListener('change', ()=>{
  const d = new Date(birthEl.value);
  const echo = document.getElementById('zodiacEcho');
  if(!isNaN(d)){
    const z = zodiacFromDate(d.getMonth()+1, d.getDate());
    const elem = zodiacElementMap[z] || "";
    const five = fiveElementFromYear(d.getFullYear());
    echo.textContent = `æ˜Ÿåº§é¢„è§ˆï¼š${z}ï¼ˆ${elem}ï¼‰Â· äº”è¡Œï¼š${five}`;
  }else{ echo.textContent = ""; }
});

/* -------- é¢˜åº“ï¼ˆ40 ç‰¹å¾ Ã— æ­£/å = 80 é“ï¼›æ­¤å¤„å±•å¼€ä¸º 80 å•é¢˜ï¼‰ -------- */
// ç”¨ä½ çš„ PAIRSï¼Œæ‹†æˆ 80 æ¡ï¼šæ¯æ¡åŒ…å« {text, dim, rev}
const PAIRS = [
  // O
  { pos:"æˆ‘ä¼šä¸»åŠ¨æ¢ç´¢æ–°æƒ³æ³•ã€æ–°å·¥å…·æˆ–æ–°æ–¹æ³•ã€‚", neg:"æˆ‘æ›´æ„¿æ„éµå¾ªæ—§æœ‰åšæ³•ï¼Œé¿å…å°è¯•æ–°ç‚¹å­ã€‚", dim:"O" },
  { pos:"æˆ‘å¯¹è‰ºæœ¯ã€å®¡ç¾æˆ–åˆ›æ„è¡¨è¾¾æœ‰çœŸå®å…´è¶£ã€‚", neg:"è‰ºæœ¯ä¸åˆ›æ„å¯¹æˆ‘æ¥è¯´å¯æœ‰å¯æ— ã€‚", dim:"O" },
  { pos:"æˆ‘èƒ½åœ¨ä¸ç¡®å®šä¸­ä¿æŒå¥½å¥‡ï¼Œæ„¿æ„è¯•é”™ã€‚", neg:"é¢å¯¹ä¸ç¡®å®šæ€§æˆ‘ä¼šé€€ç¼©æˆ–å›é¿ã€‚", dim:"O" },
  { pos:"æˆ‘å–œæ¬¢è·¨å­¦ç§‘å­¦ä¹ å¹¶è¿›è¡ŒçŸ¥è¯†è¿ç§»ã€‚", neg:"æˆ‘æ›´å€¾å‘åœ¨ç†Ÿæ‚‰çš„å•ä¸€é¢†åŸŸæ‰“è½¬ã€‚", dim:"O" },
  { pos:"æˆ‘ç»å¸¸æ„æ€æ–°ç‚¹å­å¹¶ä»˜è¯¸åŸå‹ã€‚", neg:"æˆ‘å¾ˆå°‘äº§ç”Ÿæ–°ç‚¹å­ï¼Œä¹Ÿå¾ˆå°‘å°è¯•åŸå‹ã€‚", dim:"O" },
  { pos:"æˆ‘ä¹äºæ¥å—ä¸åŒæ–‡åŒ–ä¸è§‚ç‚¹ã€‚", neg:"æˆ‘å¯¹ä¸åŒæ–‡åŒ–æˆ–è§‚ç‚¹è¾ƒä¸å®½å®¹ã€‚", dim:"O" },
  { pos:"æˆ‘èƒ½æŠŠæŠ½è±¡æ¦‚å¿µè½¬åŒ–ä¸ºå®é™…æ–¹æ¡ˆã€‚", neg:"æŠ½è±¡æ¦‚å¿µå¯¹æˆ‘æ— ç”¨ï¼Œéš¾è½¬åŒ–ä¸ºè¡ŒåŠ¨ã€‚", dim:"O" },
  { pos:"æˆ‘ä¼šä¸»åŠ¨è¿½è¸ªè¶‹åŠ¿å¹¶å¿«é€Ÿè¿­ä»£ã€‚", neg:"æˆ‘å¯¹è¶‹åŠ¿å˜åŒ–ä¸æ•æ„Ÿï¼Œä¹Ÿä¸æƒ³è°ƒæ•´æ–¹å‘ã€‚", dim:"O" },
  // C
  { pos:"æˆ‘èƒ½æŠŠå¤§ç›®æ ‡æ‹†è§£ä¸ºå¯æ‰§è¡Œçš„å°æ­¥éª¤ã€‚", neg:"æˆ‘å¸¸å¸¸åªåœç•™åœ¨æƒ³æ³•å±‚é¢ä¸å»æ‹†è§£ã€‚", dim:"C" },
  { pos:"æˆ‘ä¼šæŒ‰ä¼˜å…ˆçº§ç®¡ç†äº‹åŠ¡å¹¶å¦‚æœŸå®Œæˆã€‚", neg:"æˆ‘å¸¸å¸¸è¢«çäº‹æ‰“æ–­ï¼Œéš¾ä»¥æŒ‰æ—¶å®Œæˆã€‚", dim:"C" },
  { pos:"æˆ‘æ—¥å¸¸æœ‰èŠ‚å¾‹ï¼ˆä½œæ¯ã€å¤ç›˜ã€å¤åˆ©ï¼‰ã€‚", neg:"æˆ‘çš„ä½œæ¯æ··ä¹±ï¼Œç¼ºå°‘å¤ç›˜ä¸èŠ‚å¾‹ã€‚", dim:"C" },
  { pos:"æˆ‘é‡åˆ°é˜»åŠ›ä¹Ÿèƒ½æŒç»­æ¨è¿›ã€‚", neg:"é‡é˜»æ—¶æˆ‘å®¹æ˜“æ”¾å¼ƒæˆ–æ‹–å»¶ã€‚", dim:"C" },
  { pos:"æˆ‘åœ¨å…³é”®æ—¶åˆ»èƒ½ä¿æŒé«˜åº¦æ‰§è¡ŒåŠ›ã€‚", neg:"å…³é”®èŠ‚ç‚¹æˆ‘å¸¸å¸¸çŠ¶æ€ä¸‹æ»‘ã€‚", dim:"C" },
  { pos:"æˆ‘èƒ½æƒè¡¡å®Œç¾ä¸æ•ˆç‡å¹¶åšå–èˆã€‚", neg:"æˆ‘å¸¸é™·å…¥å®Œç¾ä¸»ä¹‰è€½è¯¯è¿›åº¦ã€‚", dim:"C" },
  { pos:"æˆ‘å¯¹ç»†èŠ‚ä¸è´¨é‡æœ‰ç¨³å®šçš„è¿½æ±‚ã€‚", neg:"æˆ‘å¯¹ç»†èŠ‚æŠŠæ§è¾ƒå¼±ï¼Œå¸¸æœ‰ç–æ¼ã€‚", dim:"C" },
  { pos:"æˆ‘ä¼šè®¾ç½®è¾¹ç•Œï¼Œä¿æŠ¤æ·±åº¦å·¥ä½œæ—¶é—´ã€‚", neg:"æˆ‘éš¾ä»¥æ‹’ç»æ‰“æ–­ï¼Œæ·±åº¦å·¥ä½œä¸è¶³ã€‚", dim:"C" },
  // E
  { pos:"æˆ‘åœ¨ç¾¤ä½“ä¸­è‡ªç„¶åœ°ä¸»åŠ¨å‘è¨€ä¸å¸¦åŠ¨æ°”æ°›ã€‚", neg:"æˆ‘åœ¨ç¾¤ä½“ä¸­å€¾å‘æ²‰é»˜æˆ–å›é¿å‘è¨€ã€‚", dim:"E" },
  { pos:"æˆ‘ç»“è¯†æ–°æœ‹å‹æ—¶é€šå¸¸æ„Ÿåˆ°å…´å¥‹è€Œéç„¦è™‘ã€‚", neg:"æˆ‘ä¸é™Œç”Ÿäººäº¤æµå¸¸ä»¤äººç´§å¼ æˆ–ç–²æƒ«ã€‚", dim:"E" },
  { pos:"æˆ‘èƒ½æŠŠæƒ³æ³•å£å¤´è¡¨è¾¾å¾—æ¸…æ™°æœ‰æ„ŸæŸ“åŠ›ã€‚", neg:"æˆ‘å£å¤´è¡¨è¾¾è¾ƒå¼±ï¼Œå¸¸éš¾ä»¥é˜è¿°æƒ³æ³•ã€‚", dim:"E" },
  { pos:"æˆ‘æ„¿æ„åœ¨å…¬å¼€åœºåˆæ‰¿æ‹…å¯è§è§’è‰²ã€‚", neg:"æˆ‘å°½é‡é¿å…æ‰¿æ‹…å…¬å¼€ä¸å¯è§è§’è‰²ã€‚", dim:"E" },
  { pos:"æˆ‘ä¸äººäº’åŠ¨èƒ½å¿«é€Ÿå»ºç«‹è¿æ¥ä¸çƒ­åº¦ã€‚", neg:"ä¸äººäº’åŠ¨å¸¸å¸¸éœ€è¦å¾ˆä¹…æ‰èƒ½çƒ­èµ·æ¥ã€‚", dim:"E" },
  { pos:"æˆ‘æœ‰ä¸€å®šçš„ä¸»å¯¼/ä¸»æŒè®¨è®ºçš„èƒ½åŠ›ã€‚", neg:"æˆ‘ç¼ºä¹ä¸»æŒè®¨è®ºæˆ–ç»„ç»‡å¯¹è¯çš„èƒ½åŠ›ã€‚", dim:"E" },
  { pos:"æˆ‘äº«å—å¤šäººåä½œå¸¦æ¥çš„èƒ½é‡ä¸èŠ‚å¥ã€‚", neg:"å¤šäººåä½œè®©æˆ‘åˆ†å¿ƒï¼Œä½æ•ˆè€Œç–²æƒ«ã€‚", dim:"E" },
  { pos:"æˆ‘åœ¨ä¼šè®®/æ´»åŠ¨ä¸­ç»å¸¸æˆä¸ºæ¨è¿›è€…ã€‚", neg:"æˆ‘åœ¨ä¼šè®®/æ´»åŠ¨ä¸­é€šå¸¸åªè¢«åŠ¨å‚ä¸ã€‚", dim:"E" },
  // A
  { pos:"æˆ‘èƒ½åœ¨åˆ†æ­§ä¸­ä¿æŒå°Šé‡ä¸åˆä½œã€‚", neg:"é‡åˆ°åˆ†æ­§æˆ‘å®¹æ˜“å¯¹æŠ—æˆ–è®¥è®½ã€‚", dim:"A" },
  { pos:"æˆ‘æ„¿æ„å€¾å¬ä»–äººéœ€æ±‚å¹¶å°è¯•æˆå…¨ã€‚", neg:"æˆ‘æ›´å¤šä¼˜å…ˆè‡ªå·±çš„éœ€æ±‚ä¸ç«‹åœºã€‚", dim:"A" },
  { pos:"æˆ‘èƒ½åœ¨åŸåˆ™ä¸åŒç†å¿ƒä¹‹é—´å–å¾—å¹³è¡¡ã€‚", neg:"æˆ‘è¦ä¹ˆè¿‡åº¦è¿å°±ï¼Œè¦ä¹ˆè¿‡åº¦å¼ºç¡¬ã€‚", dim:"A" },
  { pos:"æˆ‘ä¸äººå»ºç«‹äº’ä¿¡å…³ç³»çš„é€Ÿåº¦è¾ƒå¿«ã€‚", neg:"æˆ‘å¯¹ä»–äººæ™®éä¸ä¿¡ä»»ï¼Œå»ºç«‹å…³ç³»å¾ˆæ…¢ã€‚", dim:"A" },
  { pos:"æˆ‘ä¹äºç»™äºˆæ­£å‘åé¦ˆä¸è®¤å¯ã€‚", neg:"æˆ‘å¾ˆå°‘ä¸»åŠ¨è¡¨è¾¾æ„Ÿè°¢æˆ–è®¤å¯ã€‚", dim:"A" },
  { pos:"æˆ‘å†²çªæ—¶èƒ½æ§åˆ¶è¯­æ°”ä¸è¡¨è¾¾æ–¹å¼ã€‚", neg:"æˆ‘å†²çªæ—¶å®¹æ˜“æƒ…ç»ªåŒ–æˆ–è®½åˆºæŒ–è‹¦ã€‚", dim:"A" },
  { pos:"æˆ‘ä¹äºåˆä½œå…±èµ¢ï¼Œé¿å…é›¶å’Œæ€ç»´ã€‚", neg:"æˆ‘æ›´å¸¸ä»¥è¾“èµ¢æ¥å®šä¹‰å…³ç³»ã€‚", dim:"A" },
  { pos:"æˆ‘åœ¨å›¢é˜Ÿä¸­å¸¸è¢«è§†ä¸ºå¯é çš„åˆä½œè€…ã€‚", neg:"æˆ‘åœ¨å›¢é˜Ÿåä½œä¸­å¸¸æ˜¾å¾—ä¸åˆæ‹ã€‚", dim:"A" },
  // N
  { pos:"é¢å¯¹å‹åŠ›æˆ‘èƒ½è¾ƒå¿«æ¢å¤åˆ°ç¨³å®šçŠ¶æ€ã€‚", neg:"é¢å¯¹å‹åŠ›æˆ‘ä¼šåå¤å›æƒ³å¹¶éš¾ä»¥å¹³å¤ã€‚", dim:"N" },
  { pos:"æˆ‘èƒ½åˆ†è¾¨æƒ…ç»ªä¸äº‹å®å¹¶é¿å…è¿‡åº¦è§£è¯»ã€‚", neg:"æˆ‘å¸¸æŠŠæƒ…ç»ªå½“äº‹å®è€Œæ”¾å¤§é—®é¢˜ã€‚", dim:"N" },
  { pos:"æˆ‘é‡æŒ«æ—¶èƒ½è‡ªæˆ‘å®‰æŠšå¹¶å¯»æ±‚æ”¯æŒã€‚", neg:"æˆ‘é‡æŒ«æ—¶å®¹æ˜“è‡ªè´£æˆ–å­¤ç«‹è‡ªå·±ã€‚", dim:"N" },
  { pos:"æˆ‘èƒ½ç”¨è§„å¾‹ç”Ÿæ´»ç¨³å®šæƒ…ç»ªæ³¢åŠ¨ã€‚", neg:"æˆ‘ä½œæ¯å¤±è¡¡ï¼Œæƒ…ç»ªå¤šå—å…¶å½±å“ã€‚", dim:"N" },
  { pos:"æˆ‘å¯¹è´Ÿé¢è¯„ä»·çš„è€å—åº¦å°šå¯ã€‚", neg:"è´Ÿé¢è¯„ä»·ä¼šé•¿æ—¶é—´å½±å“æˆ‘çš„çŠ¶æ€ã€‚", dim:"N" },
  { pos:"æˆ‘èƒ½åœ¨æœªçŸ¥ä¸å˜åŠ¨ä¸­ä¿æŒåŸºæœ¬é•‡å®šã€‚", neg:"æœªçŸ¥ä¸å˜åŠ¨é€šå¸¸è®©æˆ‘ç„¦è™‘ä¸å®‰ã€‚", dim:"N" },
  { pos:"æˆ‘åŸºæœ¬ä¸è¢«å°äº‹ç‰µåŠ¨æ•´ä¸ªä¸€å¤©çš„å¿ƒæƒ…ã€‚", neg:"å°äº‹ä¹Ÿä¼šè®©æˆ‘æƒ…ç»ªä½è½å¾ˆä¹…ã€‚", dim:"N" },
  { pos:"æˆ‘èƒ½è¯†åˆ«å¹¶è°ƒæ•´éç†æ€§æƒ³æ³•ã€‚", neg:"æˆ‘å¸¸é™·å…¥â€œç¾éš¾åŒ–â€æˆ–â€œéé»‘å³ç™½â€çš„æƒ³æ³•ã€‚", dim:"N" }
];

// å±•å¼€æˆ 80 å•é¢˜
const QUESTIONS = [];
PAIRS.forEach(p=>{
  QUESTIONS.push({ text: p.pos, dim: p.dim, rev: false });
  QUESTIONS.push({ text: p.neg, dim: p.dim, rev: true  });
});

/* -------- æ¸²æŸ“ 80 é¢˜ï¼ˆæ— â€œæ­£/åå‘â€æç¤ºï¼‰ + æ»‘æ†æ•°å€¼è”åŠ¨ -------- */
const form = document.getElementById('quizForm');
const movedEl = document.getElementById('movedCount');
const pgEl = document.getElementById('pg');

function renderQuestions(){
  form.innerHTML = "";
  QUESTIONS.forEach((q, idx)=>{
    const i = idx + 1;
    const box = document.createElement('div');
    box.className = 'q';
    box.innerHTML = `
      <h4>${i}. ${q.text}</h4>
      <div class="item">
        <input type="range" min="1" max="5" step="1" value="3" name="q${i}" data-dim="${q.dim}" data-rev="${q.rev?1:0}"/>
        <div class="muted">1 Â·Â·Â· 5</div>
        <div class="val" id="v${i}">3</div>
      </div>
    `;
    form.appendChild(box);

    const slider = box.querySelector(`input[name="q${i}"]`);
    const valBox = box.querySelector(`#v${i}`);
    slider.addEventListener('input', ()=>{
      valBox.textContent = slider.value;            // âœ… æ•°å­—è”åŠ¨
      if(!slider.dataset.moved){ slider.dataset.moved = "1"; updateProgress(); }
    });
  });
}

function updateProgress(){
  const all = form.querySelectorAll('input[type="range"]');
  let moved = 0; all.forEach(el=>{ if(el.dataset.moved==="1") moved++; });
  movedEl.textContent = moved; pgEl.value = moved;
}
renderQuestions(); updateProgress();

/* -------- è®¡åˆ†ï¼ˆå¤§äº”ï¼‰ä¸å››æ¶²è´¨æ˜ å°„ -------- */
function computeBigFive(){
  const dims={O:0,C:0,E:0,A:0,N:0}, counts={O:0,C:0,E:0,A:0,N:0};
  form.querySelectorAll('input[type="range"]').forEach(el=>{
    const v = parseInt(el.value,10);
    const score = el.dataset.rev==="1" ? (6 - v) : v; // åå‘è½¬æ­£
    const d = el.dataset.dim;
    dims[d]+=score; counts[d]+=1;
  });
  const pct=(sum,cnt)=> Math.round(sum/(cnt*5)*100);
  return [pct(dims.O,counts.O), pct(dims.C,counts.C), pct(dims.E,counts.E), pct(dims.A,counts.A), pct(dims.N,counts.N)];
}
function bigFiveToTemperaments([O,C,E,A,N]){
  const ES=100-N;
  let S=0.5*E+0.3*O+0.2*ES;
  let Ch=0.4*E+0.4*C-0.2*A+0.2*ES;
  let M=0.5*N+0.2*C-0.2*E+0.1*A;
  let P=0.4*A+0.3*ES+0.2*C-0.1*E;
  S=Math.max(0,S);Ch=Math.max(0,Ch);M=Math.max(0,M);P=Math.max(0,P);
  const sum=S+Ch+M+P || 1;
  return {
    å¤šè¡€è´¨:Math.round(S/sum*100),
    èƒ†æ±è´¨:Math.round(Ch/sum*100),
    æŠ‘éƒè´¨:Math.round(M/sum*100),
    ç²˜æ¶²è´¨:Math.round(P/sum*100)
  };
}

/* -------- ä¿å­˜å¹¶è¿›å…¥ Step2ï¼ˆä¸å±•ç¤ºç»“æœï¼‰ -------- */
document.getElementById('saveNext').addEventListener('click', ()=>{
  const bf = computeBigFive();
  const temp = bigFiveToTemperaments(bf);

  // å‡ºç”Ÿæ—¥æœŸ â†’ æ˜Ÿåº§/å››è±¡/äº”è¡Œï¼ˆä¿å­˜ä½†ä¸å±•ç¤ºï¼‰
  const birth = birthEl.value;
  if(birth){
    const d=new Date(birth);
    const z = zodiacFromDate(d.getMonth()+1, d.getDate());
    const elem = zodiacElementMap[z] || "";
    const five = fiveElementFromYear(d.getFullYear());
    localStorage.setItem('zodiac', z);
    localStorage.setItem('zodiacElement', elem);
    localStorage.setItem('fiveElement', five);
  }

  localStorage.setItem('selfScores', JSON.stringify(bf));            // [O,C,E,A,N]
  localStorage.setItem('temperamentSelf', JSON.stringify(temp));     // å››æ¶²è´¨

  window.location.assign('step2.html');
});
</script>
</body>
</html>
