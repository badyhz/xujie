<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Step 1 - è‡ªè¯„é—®å·ï¼ˆå¤§äº”äººæ ¼ 80 é¢˜ï¼‰</title>
  <style>
    /* å…¨å±€æ ·å¼ */
    :root {
      --bg: #f9fafc;
      --card: #ffffff;
      --primary: #4dabf7;
      --text: #333;
      --muted: #6c757d;
      --border: #e0e0e0;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: "Noto Sans SC", system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      padding: 20px;
    }

    /* å®¹å™¨ */
    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    /* æ ‡é¢˜ */
    h1 {
      text-align: center;
      margin-bottom: 16px;
      color: #222;
    }

    .subtitle {
      text-align: center;
      color: var(--muted);
      font-size: 15px;
      margin-bottom: 30px;
    }

    /* ä¿¡æ¯è¾“å…¥æ¡† */
    .info-group {
      background: var(--card);
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 24px;
      border-left: 4px solid var(--primary);
    }

    .info-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      font-size: 16px;
      color: var(--text);
    }

    .info-group input[type="date"] {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 16px;
      outline: none;
    }

    .info-group input[type="date"]:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(77, 171, 247, 0.25);
    }

    /* é—®é¢˜æ ·å¼ */
    .question {
      margin-bottom: 18px;
      background: var(--card);
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-left: 4px solid var(--primary);
    }

    .question label {
      display: block;
      margin-bottom: 12px;
      font-weight: 500;
      font-size: 16px;
      color: var(--text);
    }

    /* æ»‘å—å®¹å™¨ */
    .slider-container {
      position: relative;
    }

    /* æ»‘å—å€¼æ˜¾ç¤º */
    .slider-value {
      position: absolute;
      top: -25px;
      right: 0;
      font-size: 14px;
      color: var(--primary);
      font-weight: bold;
    }

    /* æ»‘å—æ ·å¼ */
    input[type="range"] {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: var(--border);
      outline: none;
      -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: var(--primary);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    /* æäº¤æŒ‰é’® */
    .submit-btn {
      padding: 14px 24px;
      border: none;
      border-radius: 8px;
      background: var(--primary);
      color: #fff;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      margin-top: 30px;
      transition: all 0.2s ease;
      width: 100%;
      max-width: 300px;
    }

    .submit-btn:hover {
      background: #3a97e0;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(77, 171, 247, 0.3);
    }

    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“‹ Step 1: è‡ªè¯„é—®å·ï¼ˆå¤§äº”äººæ ¼ 80 é¢˜ï¼‰</h1>
    <p class="subtitle">è¯·æ ¹æ®æ‚¨çš„çœŸå®æƒ…å†µï¼Œé€‰æ‹©æœ€ç¬¦åˆçš„é€‰é¡¹ã€‚1=éå¸¸ä¸åŒæ„ï¼Œ5=éå¸¸åŒæ„ã€‚</p>
    
    <!-- æ–°å¢ï¼šä¿¡æ¯è¾“å…¥æ¡† -->
    <div class="info-group">
      <label for="birthDate">ğŸ“… è¯·å¡«å†™æ‚¨çš„å‡ºç”Ÿæ—¥æœŸä»¥è®¡ç®—æ˜Ÿåº§ï¼š</label>
      <input type="date" id="birthDate" required>
    </div>

    <form id="quizForm">
      <!-- é—®é¢˜å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
    </form>
    <div style="text-align:center; margin-top: 20px;">
      <button type="submit" form="quizForm" class="submit-btn" id="submitBtn">ä¿å­˜å¹¶è¿›å…¥ç¬¬äºŒæ­¥ â¡</button>
    </div>
  </div>

  <script>
    // 1. é—®é¢˜åº“ (80é¢˜ï¼Œ16é¢˜/ç»´åº¦)
    const QUESTIONS = {
      å¼€æ”¾æ€§: [
        "æˆ‘å–œæ¬¢å°è¯•æ–°é²œäº‹ç‰©",
        "æˆ‘å¸¸å¸¸å¯¹æœªçŸ¥ä¿æŒå¥½å¥‡",
        "æˆ‘å–œæ¬¢è‰ºæœ¯å’Œåˆ›æ„æ´»åŠ¨",
        "æˆ‘èƒ½è½»æ¾æ¥å—ä¸åŒçš„æ–‡åŒ–å’Œè§‚ç‚¹",
        "æˆ‘ä¸å–œæ¬¢æ”¹å˜ï¼Œåå¥½ç†Ÿæ‚‰çš„ç¯å¢ƒï¼ˆåå‘ï¼‰",
        "æˆ‘è®¨åŒå¤æ‚çš„é—®é¢˜ï¼ˆåå‘ï¼‰",
        "æˆ‘å®¹æ˜“è¢«æ–°å¥‡äº‹ç‰©å¸å¼•",
        "æˆ‘å¸¸å¸¸å¹»æƒ³æœªæ¥çš„å¯èƒ½æ€§",
        "æˆ‘æ„¿æ„æŒ‘æˆ˜ä¼ ç»Ÿæ€ç»´",
        "æˆ‘å¯¹å“²å­¦å’ŒæŠ½è±¡é—®é¢˜æ„Ÿå…´è¶£",
        "æˆ‘ä¸å–œæ¬¢æŠ½è±¡çš„è®¨è®ºï¼ˆåå‘ï¼‰",
        "æˆ‘ä¹ æƒ¯éµå¾ªå¸¸è§„ï¼Œä¸å–œæ¬¢å†’é™©ï¼ˆåå‘ï¼‰",
        "æˆ‘æ¬£èµæ–°é¢–çš„è®¾è®¡å’Œæƒ³æ³•",
        "æˆ‘å®¹æ˜“æ¥å—ä¸ç¡®å®šæ€§",
        "æˆ‘å¯¹ç§‘å­¦æ¢ç´¢æœ‰å…´è¶£",
        "æˆ‘å–œæ¬¢ä¸æ–­å­¦ä¹ æ–°çŸ¥è¯†"
      ],
      å°½è´£æ€§: [
        "æˆ‘åšäº‹æœ‰è®¡åˆ’æ€§",
        "æˆ‘æ³¨é‡ç»†èŠ‚",
        "æˆ‘èƒ½åšæŒå®Œæˆé•¿æœŸç›®æ ‡",
        "æˆ‘ä¼šè®¤çœŸå±¥è¡Œæ‰¿è¯º",
        "æˆ‘ç»å¸¸æ‹–å»¶ï¼ˆåå‘ï¼‰",
        "æˆ‘åšäº‹ç²—å¿ƒå¤§æ„ï¼ˆåå‘ï¼‰",
        "æˆ‘æ“…é•¿åˆ¶å®šå¹¶éµå®ˆæ—¶é—´è¡¨",
        "æˆ‘èƒ½é«˜æ•ˆå®Œæˆä»»åŠ¡",
        "æˆ‘ä¼šæå‰å‡†å¤‡ï¼Œé¿å…æ„å¤–æƒ…å†µ",
        "æˆ‘åœ¨ä»»åŠ¡ä¸­ä¸€ä¸ä¸è‹Ÿ",
        "æˆ‘ç»å¸¸åŠé€”è€ŒåºŸï¼ˆåå‘ï¼‰",
        "æˆ‘å¾ˆå®¹æ˜“åˆ†å¿ƒï¼ˆåå‘ï¼‰",
        "æˆ‘å¯¹è´£ä»»æ„Ÿåˆ°é‡è§†",
        "æˆ‘å–œæ¬¢æœ‰æ¡ç†çš„ç”Ÿæ´»",
        "æˆ‘åšäº‹å¾ˆæœ‰çºªå¾‹æ€§",
        "æˆ‘é‡è§†é•¿æœŸè§„åˆ’"
      ],
      å¤–å‘æ€§: [
        "æˆ‘å–œæ¬¢ç»“è¯†æ–°æœ‹å‹",
        "æˆ‘åœ¨ç¤¾äº¤åœºåˆå¾ˆæ´»è·ƒ",
        "æˆ‘å®¹æ˜“è¡¨è¾¾æƒ…æ„Ÿ",
        "æˆ‘å–œæ¬¢æˆä¸ºäººç¾¤ä¸­çš„ç„¦ç‚¹",
        "æˆ‘å®³æ€•åœ¨äººç¾¤ä¸­å‘è¨€ï¼ˆåå‘ï¼‰",
        "æˆ‘ä¸å–œæ¬¢ä¸äººäº’åŠ¨ï¼ˆåå‘ï¼‰",
        "æˆ‘ä¹äºåˆ†äº«è‡ªå·±çš„æƒ³æ³•",
        "æˆ‘ç²¾åŠ›å……æ²›",
        "æˆ‘å–œæ¬¢å¸¦åŠ¨æ°”æ°›",
        "æˆ‘èƒ½è½»æ¾å’Œé™Œç”ŸäººèŠå¤©",
        "æˆ‘å¸¸å¸¸é¿å…èšä¼šï¼ˆåå‘ï¼‰",
        "æˆ‘ä¹ æƒ¯ç‹¬è‡ªå¾…ç€ï¼ˆåå‘ï¼‰",
        "æˆ‘å–„äºç¤¾äº¤è¡¨è¾¾",
        "æˆ‘å–œæ¬¢ä¸å›¢é˜Ÿä¸€èµ·å·¥ä½œ",
        "æˆ‘äº«å—çƒ­é—¹çš„æ°›å›´",
        "æˆ‘å®¹æ˜“ä¸äººå»ºç«‹è”ç³»"
      ],
      å®œäººæ€§: [
        "æˆ‘æ„¿æ„å¸®åŠ©ä»–äºº",
        "æˆ‘å¾ˆå®¹æ˜“ä½“è°…ä»–äººæ„Ÿå—",
        "æˆ‘å€¾å‘äºåˆä½œè€Œä¸æ˜¯ç«äº‰",
        "æˆ‘å–œæ¬¢ç»´æŠ¤å’Œè°çš„äººé™…å…³ç³»",
        "æˆ‘å¸¸å¸¸å¿½è§†åˆ«äººçš„æ„Ÿå—ï¼ˆåå‘ï¼‰",
        "æˆ‘å®¹æ˜“ä¸ä»–äººå‘ç”Ÿå†²çªï¼ˆåå‘ï¼‰",
        "æˆ‘ä¿¡ä»»åˆ«äºº",
        "æˆ‘æ„¿æ„å¦¥åä»¥é¿å…çŸ›ç›¾",
        "æˆ‘å¾ˆå°‘æ€€ç–‘ä»–äººçš„åŠ¨æœº",
        "æˆ‘å–„äºå€¾å¬",
        "æˆ‘å®¹æ˜“æ€€æ¨åœ¨å¿ƒï¼ˆåå‘ï¼‰",
        "æˆ‘ç»å¸¸æ‰¹è¯„ä»–äººï¼ˆåå‘ï¼‰",
        "æˆ‘å–œæ¬¢é¼“åŠ±å’Œæ”¯æŒä»–äºº",
        "æˆ‘åœ¨å›¢é˜Ÿä¸­æ³¨é‡å…±è¯†",
        "æˆ‘æ„¿æ„ä¸ºæœ‹å‹ä»˜å‡º",
        "æˆ‘å¾ˆå°‘æ€€æœ‰æ•Œæ„"
      ],
      ç¥ç»è´¨: [
        "æˆ‘å®¹æ˜“æ„Ÿåˆ°ç„¦è™‘",
        "æˆ‘å¸¸å¸¸æ‹…å¿ƒå°äº‹",
        "æˆ‘å®¹æ˜“æ„Ÿåˆ°å‹åŠ›",
        "æˆ‘ç»å¸¸æ„Ÿåˆ°ä¸å®‰",
        "æˆ‘å¾ˆå°‘æƒ…ç»ªæ³¢åŠ¨ï¼ˆåå‘ï¼‰",
        "æˆ‘èƒ½è½»æ¾åº”å¯¹æŒ«æŠ˜ï¼ˆåå‘ï¼‰",
        "æˆ‘å®¹æ˜“é™·å…¥è´Ÿé¢æƒ…ç»ª",
        "æˆ‘å¸¸å¸¸ç¼ºä¹å®‰å…¨æ„Ÿ",
        "æˆ‘åœ¨å‹åŠ›ä¸‹å®¹æ˜“å´©æºƒ",
        "æˆ‘å¯¹æ‰¹è¯„è¿‡åº¦æ•æ„Ÿ",
        "æˆ‘æƒ…ç»ªå¾ˆç¨³å®šï¼ˆåå‘ï¼‰",
        "æˆ‘ä¸å®¹æ˜“è¢«æ‰“ä¹±æƒ…ç»ªï¼ˆåå‘ï¼‰",
        "æˆ‘ç»å¸¸åå¤æ€è€ƒé”™è¯¯",
        "æˆ‘å®¹æ˜“æƒ…ç»ªåŒ–",
        "æˆ‘å¯¹æœªæ¥å……æ»¡æ‹…å¿§",
        "æˆ‘å¸¸å¸¸å› ä¸ºå°äº‹å¤±çœ "
      ]
    };

    // 2. å·¥å…·å‡½æ•°
    const Utils = {
      // è®¡ç®—æ˜Ÿåº§
      getZodiacSign: (date) => {
        const month = date.getMonth() + 1; // getMonth() è¿”å› 0-11
        const day = date.getDate();
        
        // æ˜Ÿåº§æ—¥æœŸèŒƒå›´
        const zodiacs = [
          { name: "æ°´ç“¶åº§", start: [1, 20], end: [2, 18] },
          { name: "åŒé±¼åº§", start: [2, 19], end: [3, 20] },
          { name: "ç™½ç¾Šåº§", start: [3, 21], end: [4, 19] },
          { name: "é‡‘ç‰›åº§", start: [4, 20], end: [5, 20] },
          { name: "åŒå­åº§", start: [5, 21], end: [6, 21] },
          { name: "å·¨èŸ¹åº§", start: [6, 22], end: [7, 22] },
          { name: "ç‹®å­åº§", start: [7, 23], end: [8, 22] },
          { name: "å¤„å¥³åº§", start: [8, 23], end: [9, 22] },
          { name: "å¤©ç§¤åº§", start: [9, 23], end: [10, 23] },
          { name: "å¤©èåº§", start: [10, 24], end: [11, 22] },
          { name: "å°„æ‰‹åº§", start: [11, 23], end: [12, 21] },
          { name: "æ‘©ç¾¯åº§", start: [12, 22], end: [1, 19] } // è·¨å¹´
        ];

        // å¤„ç†è·¨å¹´æ˜Ÿåº§ï¼ˆæ‘©ç¾¯åº§ï¼‰
        if (month === 12 && day >= 22) return "æ‘©ç¾¯åº§";
        if (month === 1 && day <= 19) return "æ‘©ç¾¯åº§";

        // éå†å…¶ä»–æ˜Ÿåº§
        for (const z of zodiacs) {
          if (month === z.start[0] && day >= z.start[1]) return z.name;
          if (month === z.end[0] && day <= z.end[1]) return z.name;
        }
        return "æœªçŸ¥";
      },

      // å°†åˆ†æ•°ä»5åˆ†åˆ¶è½¬æ¢ä¸ºç™¾åˆ†åˆ¶ (å¹³å‡å€¼ * 20)
      toPercentile: (rawScore, count) => {
        return Math.round((rawScore / count) * 20);
      },

      // ä¿å­˜æ•°æ®åˆ°LocalStorage
      saveToStorage: (key, data) => {
        try {
          localStorage.setItem(key, JSON.stringify(data));
          return true;
        } catch (e) {
          console.error("ä¿å­˜æ•°æ®å¤±è´¥:", e);
          return false;
        }
      }
    };

    // 3. ä¸»è¦é€»è¾‘
    class QuizApp {
      constructor() {
        this.form = document.getElementById("quizForm");
        this.submitBtn = document.getElementById("submitBtn");
        this.birthDateInput = document.getElementById("birthDate");
        this.scores = { å¼€æ”¾æ€§: 0, å°½è´£æ€§: 0, å¤–å‘æ€§: 0, å®œäººæ€§: 0, ç¥ç»è´¨: 0 };
        this.totalQuestions = 0;
      }

      // æ¸²æŸ“æ‰€æœ‰é—®é¢˜
      renderQuestions() {
        let questionIndex = 1;
        for (const [trait, questions] of Object.entries(QUESTIONS)) {
          questions.forEach(questionText => {
            const isReversed = questionText.includes("ï¼ˆåå‘ï¼‰");
            const questionId = `q${questionIndex}`;
            
            const div = document.createElement("div");
            div.className = "question";
            div.innerHTML = `
              <label for="${questionId}">${questionIndex}. ${questionText.replace("ï¼ˆåå‘ï¼‰", "")}</label>
              <div class="slider-container">
                <input type="range" min="1" max="5" value="3" name="${questionId}" id="${questionId}" 
                       data-trait="${trait}" data-reversed="${isReversed}">
                <span class="slider-value" id="value-${questionId}">3</span>
              </div>
            `;
            this.form.appendChild(div);
            questionIndex++;
            this.totalQuestions++;
          });
        }

        // ä¸ºæ‰€æœ‰æ»‘å—æ·»åŠ å®æ—¶åé¦ˆ
        this.form.querySelectorAll('input[type="range"]').forEach(slider => {
          slider.addEventListener('input', (e) => {
            document.getElementById(`value-${e.target.id}`).textContent = e.target.value;
          });
        });
      }

      // è®¡ç®—æœ€ç»ˆå¾—åˆ†
      calculateScores() {
        this.scores = { å¼€æ”¾æ€§: 0, å°½è´£æ€§: 0, å¤–å‘æ€§: 0, å®œäººæ€§: 0, ç¥ç»è´¨: 0 };
        let traitCounts = { å¼€æ”¾æ€§: 0, å°½è´£æ€§: 0, å¤–å‘æ€§: 0, å®œäººæ€§: 0, ç¥ç»è´¨: 0 };

        for (let i = 1; i <= this.totalQuestions; i++) {
          const input = this.form[`q${i}`];
          const val = parseInt(input.value);
          const trait = input.dataset.trait;
          const isReversed = input.dataset.reversed === 'true';
          
          // å¤„ç†åå‘é¢˜
          const score = isReversed ? (6 - val) : val;
          this.scores[trait] += score;
          traitCounts[trait]++;
        }

        // è½¬æ¢ä¸ºç™¾åˆ†åˆ¶
        const percentileScores = Object.keys(this.scores).map(trait => {
          return Utils.toPercentile(this.scores[trait], traitCounts[trait]);
        });

        return percentileScores;
      }

      // å¤„ç†è¡¨å•æäº¤
      handleSubmit(e) {
        e.preventDefault();
        
        // éªŒè¯æ—¥æœŸæ˜¯å¦å·²å¡«å†™
        if (!this.birthDateInput.value) {
          alert("è¯·å¡«å†™æ‚¨çš„å‡ºç”Ÿæ—¥æœŸï¼");
          this.birthDateInput.focus();
          return;
        }

        this.submitBtn.disabled = true;
        this.submitBtn.textContent = "æ­£åœ¨ä¿å­˜...";

        try {
          // 1. è®¡ç®—å¹¶ä¿å­˜æ˜Ÿåº§
          const birthDate = new Date(this.birthDateInput.value);
          const zodiac = Utils.getZodiacSign(birthDate);
          const zodiacSuccess = Utils.saveToStorage("zodiac", zodiac);
          if (!zodiacSuccess) throw new Error("æ˜Ÿåº§ä¿å­˜å¤±è´¥");

          // 2. è®¡ç®—å¹¶ä¿å­˜äººæ ¼åˆ†æ•°
          const finalScores = this.calculateScores();
          const scoresSuccess = Utils.saveToStorage("selfScores", finalScores);
          if (!scoresSuccess) throw new Error("äººæ ¼åˆ†æ•°ä¿å­˜å¤±è´¥");
          
          // 3. è·³è½¬
          setTimeout(() => {
            alert(`âœ… é—®å·å®Œæˆï¼æ‚¨çš„æ˜Ÿåº§æ˜¯ ${zodiac}ã€‚å³å°†è¿›å…¥ä¸‹ä¸€æ­¥ã€‚`);
            window.location.assign("step2.html");
          }, 500);

        } catch (error) {
          this.submitBtn.disabled = false;
          this.submitBtn.textContent = "ä¿å­˜å¹¶è¿›å…¥ç¬¬äºŒæ­¥ â¡";
          alert(`âŒ ä¿å­˜å¤±è´¥ï¼š${error.message}ã€‚è¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®æˆ–é‡è¯•ã€‚`);
          console.error("æäº¤å¤±è´¥:", error);
        }
      }

      // åˆå§‹åŒ–
      init() {
        this.renderQuestions();
        this.form.addEventListener("submit", (e) => this.handleSubmit(e));
      }
    }

    // å¯åŠ¨åº”ç”¨
    document.addEventListener("DOMContentLoaded", () => {
      new QuizApp().init();
    });
  </script>
</body>
</html>