<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Step 2 - ç¯å¢ƒä¸è¡Œä¸ºæ ‡ç­¾ï¼ˆè¡Œä¸š/èŒä½=å•é€‰ï¼‰</title>
<style>
  body{margin:0;background:#f6f7fb;font-family:"Noto Sans SC",system-ui}
  .container{max-width:1180px;margin:0 auto;padding:18px}
  h1{margin:8px 0}
  .grid{display:grid;grid-template-columns:2fr 1fr;gap:16px}
  .panel{background:#fff;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.06);padding:16px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  select,input[type=range]{padding:8px;border:1px solid #e5e7eb;border-radius:10px}
  .lib{max-height:520px;overflow:auto;margin-top:8px}
  .cat{margin:10px 0 6px;font-weight:700}
  .tag{border:1px solid #e7f5ff;background:#f8fbff;border-radius:10px;padding:10px;margin:6px 0}
  .tag h4{margin:0 0 6px;font-size:14px}
  .tag .desc{font-size:12px;color:#6c757d}
  .tag .ctrl{display:flex;gap:12px;align-items:center;margin-top:6px}
  .tag button{padding:6px 10px;border:none;border-radius:8px;background:#4dabf7;color:#fff;cursor:pointer}
  .sel{display:flex;flex-direction:column;gap:8px;max-height:710px;overflow:auto}
  .item{background:#f8fbff;border:1px solid #e7f5ff;border-radius:12px;padding:10px;display:flex;gap:8px}
  .meta{flex:1}
  .pill{font-size:12px;background:#edf2ff;color:#3b5bdb;border-radius:999px;padding:2px 8px}
  .rm{background:#ffe3e3;color:#c92a2a;border:none;border-radius:8px;padding:6px 8px;cursor:pointer}
  .actions{display:flex;justify-content:space-between;gap:10px;margin-top:12px}
  button.primary{padding:12px 18px;border:none;border-radius:10px;background:#4dabf7;color:#fff;cursor:pointer}
  button.ghost{padding:12px 18px;border:none;border-radius:10px;background:#e9ecef;color:#222;cursor:pointer}
  .search{display:flex;gap:8px;margin-top:8px}
  .search input{flex:1;padding:8px 10px;border:1px solid #e5e7eb;border-radius:10px}
  .tiny{font-size:12px;color:#6c757d}
</style>
</head>
<body>
<div class="container">
  <h1>Step 2 Â· ç¯å¢ƒä¸è¡Œä¸ºæ ‡ç­¾</h1>
  <div class="grid">
    <section class="panel">
      <h2>ğŸ¢ èŒä¸šçƒ™å°ï¼ˆå•é€‰ï¼‰</h2>
      <div class="row">
        <label>è¡Œä¸šï¼š</label>
        <select id="industry"></select>
        <label>å½±å“æƒé‡</label>
        <input id="wIndustry" type="range" min="1" max="10" value="5"/>
        <span id="wIndustryVal" class="tiny">5</span>
      </div>
      <div class="row" style="margin-top:8px">
        <label>èŒä½ï¼š</label>
        <select id="position"></select>
        <label>å½±å“æƒé‡</label>
        <input id="wPosition" type="range" min="1" max="10" value="5"/>
        <span id="wPositionVal" class="tiny">5</span>
      </div>

      <h2 style="margin-top:18px">ğŸŒ å…¶ä»–æ ‡ç­¾ï¼ˆå¤šé€‰ + æƒé‡ï¼‰</h2>
      <div class="search">
        <input id="kw" placeholder="æœç´¢æ ‡ç­¾æˆ–è§£é‡Šå…³é”®è¯â€¦ï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼‰"/>
        <button class="primary" id="clearFilter">é‡ç½®</button>
      </div>
      <div id="lib" class="lib"></div>
      <div class="tiny">å…± <span id="totalCount">0</span> ä¸ªå­æ ‡ç­¾ Â· å½“å‰æ˜¾ç¤º <span id="visibleCount">0</span> ä¸ª</div>
    </section>

    <aside class="panel">
      <h2>âœ… å·²é€‰æ ‡ç­¾</h2>
      <div id="selected" class="sel"></div>
      <div class="actions">
        <button class="ghost" onclick="location.href='step1.html'">â¬… ä¸Šä¸€æ­¥</button>
        <button class="primary" id="saveNext">ä¿å­˜å¹¶ç”ŸæˆæŠ¥å‘Š âœ</button>
      </div>
    </aside>
  </div>
</div>

<script>
/* ================== åŸºç¡€ï¼šè¡Œä¸š/èŒä½ï¼ˆå•é€‰ + æƒé‡ï¼‰ ================== */
const INDUSTRIES = [
  "äº’è”ç½‘/è½¯ä»¶","äººå·¥æ™ºèƒ½","é‡‘è/æŠ•èµ„","åˆ¶é€ /å·¥ä¸š","åŒ»ç–—/åŒ»è¯","æ•™è‚²/åŸ¹è®­","åª’ä½“/å†…å®¹","ç”µå•†/é›¶å”®",
  "æ¸¸æˆ/å¨±ä¹","èƒ½æº/ç¯ä¿","æˆ¿åœ°äº§/å»ºç­‘","ç‰©æµ/ä¾›åº”é“¾"
];
const POSITIONS = [
  "äº§å“ç»ç†","åç«¯å·¥ç¨‹å¸ˆ","å‰ç«¯å·¥ç¨‹å¸ˆ","ç®—æ³•å·¥ç¨‹å¸ˆ","æ•°æ®åˆ†æ","æ•°æ®å·¥ç¨‹","æµ‹è¯•/QA","è¿ç»´/å¹³å°",
  "é”€å”®","è¿è¥","è®¾è®¡å¸ˆ","é¡¹ç›®ç»ç†","å†…å®¹ç¼–è¾‘","HR","æ³•åŠ¡","è´¢åŠ¡"
];

/* è¡Œä¸š/èŒä½çš„ Big5 å‘é‡ï¼ˆç¤ºä¾‹ï¼Œå¯è°ƒæ•´ï¼‰ */
const big5DeltaRole = {
  // è¡Œä¸šï¼šO C E A N
  "äº’è”ç½‘/è½¯ä»¶":[+5,+4,+2, 0, 0],
  "äººå·¥æ™ºèƒ½":[+6,+4,+1, 0,+1],
  "é‡‘è/æŠ•èµ„":[-2,+7, 0,-2,+2],
  "åˆ¶é€ /å·¥ä¸š":[-1,+6,-1, 0, 0],
  "åŒ»ç–—/åŒ»è¯":[ 0,+6,-1,+2,+1],
  "æ•™è‚²/åŸ¹è®­":[+2,+3, 0,+3, 0],
  "åª’ä½“/å†…å®¹":[+5, 0,+2, 0,+1],
  "ç”µå•†/é›¶å”®":[+2,+3,+2, 0, 0],
  "æ¸¸æˆ/å¨±ä¹":[+6, 0,+3,-1,+2],
  "èƒ½æº/ç¯ä¿":[+3,+4, 0,+1, 0],
  "æˆ¿åœ°äº§/å»ºç­‘":[-1,+5, 0, 0, 0],
  "ç‰©æµ/ä¾›åº”é“¾":[-1,+5, 0, 0, 0],
  // èŒä½
  "äº§å“ç»ç†":[+4,+5,+3, 0, 0],
  "åç«¯å·¥ç¨‹å¸ˆ":[+1,+5,-1, 0, 0],
  "å‰ç«¯å·¥ç¨‹å¸ˆ":[+2,+4, 0, 0, 0],
  "ç®—æ³•å·¥ç¨‹å¸ˆ":[+3,+5,-1, 0,+1],
  "æ•°æ®åˆ†æ":[+1,+4,-1, 0, 0],
  "æ•°æ®å·¥ç¨‹":[ 0,+4,-1, 0, 0],
  "æµ‹è¯•/QA":[ 0,+6,-1, 0, 0],
  "è¿ç»´/å¹³å°":[ 0,+5,-1, 0, 0],
  "é”€å”®":[ 0, 0,+10,-3,+2],
  "è¿è¥":[ 0,+3,+2, 0, 0],
  "è®¾è®¡å¸ˆ":[+6, 0,+1, 0, 0],
  "é¡¹ç›®ç»ç†":[ 0,+6,+2, 0, 0],
  "å†…å®¹ç¼–è¾‘":[+4, 0, 0, 0, 0],
  "HR":[ 0,+2,+1,+4, 0],
  "æ³•åŠ¡":[-2,+6,-2, 0, 0],
  "è´¢åŠ¡":[-2,+6,-2, 0, 0]
};

/* ================== 200 å­æ ‡ç­¾åº“ï¼ˆç±»åˆ«/æ ‡ç­¾/è§£é‡Šï¼‰ ==================
   å…­å¤§ç±»ï¼šå…³é”®äº‹ä»¶ã€ç¤¾ä¼šé˜¶å±‚ã€æ¶ˆè´¹å°è®°ã€ç¤¾äº¤æŒ‡çº¹ã€æ—¶é—´åˆ†é…ã€æ•°å­—è‚¢ä½“è¯­è¨€
   é‡‡ç”¨è§„åˆ™æ˜ å°„å™¨è®¡ç®—å¤§äº”å½±å“ï¼Œä¾¿äºç»Ÿä¸€ç»´æŠ¤ã€‚
===================================================================== */
const TAGS_EVENTS = [ // 18
  {label:"é‡å¤§å¤±è´¥",desc:"ç»å†é‡å¤§æŒ«è´¥ï¼Œä»·å€¼è§‚ä¸æŠ—å‹æ–¹å¼é‡å¡‘"},
  {label:"çªé‡è´µäºº",desc:"è·å¾—å…³é”®å¸®åŠ©ï¼Œæ‰©å±•æœºé‡ä¸èµ„æº"},
  {label:"ç§»æ°‘ç»å†",desc:"è·¨æ–‡åŒ–é€‚åº”ï¼Œè®¤çŸ¥è¾¹ç•Œä¸ç¤¾äº¤ç½‘ç»œé‡æ„"},
  {label:"è‡ªç„¶ç¾å®³",desc:"çªå‘é£é™©ä¸å¤åŸåŠ›è€ƒéªŒ"},
  {label:"é‡å¤§ç–¾ç—…",desc:"é•¿æœŸåº·å¤æˆ–ç…§æŠ¤ç»å†ï¼Œç”Ÿå‘½è§‚æ”¹å˜"},
  {label:"æ„å¤–è´¢å¯Œ",desc:"èµ„æºéª¤å¢å¸¦æ¥çš„é€‰æ‹©ä¸è¯•æ¢"},
  {label:"åˆ›ä¸šå¤±è´¥",desc:"é«˜å‹è¯•é”™ï¼Œå¿ƒæ€ä¸æ‰§è¡ŒåŠ›çš„åŒé‡æ£€éªŒ"},
  {label:"å…¬å¼€æ¼”è®²æˆåŠŸ",desc:"èˆå°ç»éªŒå¢å¼ºè‡ªæˆ‘æ•ˆèƒ½æ„Ÿ"},
  {label:"é•¿æœŸå¼‚åœ°æ‹",desc:"æƒ…ç»ªç®¡ç†ä¸æ‰¿è¯ºè€ƒéªŒ"},
  {label:"å‡å­¦è·³çº§",desc:"æ—©æœŸæˆå°±å¸¦æ¥çš„è®¤çŸ¥ç»“æ„å½±å“"},
  {label:"å®¶åº­å˜æ•…",desc:"è§’è‰²è½¬å˜ä¸è´£ä»»é‡æ„"},
  {label:"èŒä¸šè½¬è¡Œ",desc:"è·¨è·¯å¾„è¿ç§»ï¼Œå¼€æ”¾æ€§ä¸ä¸ç¡®å®šæ‰¿å—"},
  {label:"é•¿é€”å¾’æ­¥",desc:"è€åŠ›ä¸è‡ªæˆ‘å¯¹è¯"},
  {label:"å¿—æ„¿è€…æœåŠ¡",desc:"åŒç†ä¸åˆ©ä»–åŠ¨æœºå¼ºåŒ–"},
  {label:"ç«æŠ€å¤ºå† ",desc:"ç›®æ ‡é”šå®šä¸èƒœä»»ä¿¡å¿µæå‡"},
  {label:"å­¦æœ¯ä¸ç«¯å†²å‡»",desc:"ä¿¡å¿µå´©å¡Œåçš„å†å»ºæ„"},
  {label:"è€ƒè¯•å¤±åˆ©",desc:"çŸ­æœŸæŒ«è´¥ä¸é•¿æœŸå­¦ä¹ ç­–ç•¥è°ƒæ•´"},
  {label:"äº²å¯†å…³ç³»ç ´è£‚",desc:"ä¾æ‹é£æ ¼ä¸ä¿¡ä»»ç³»ç»Ÿé‡å¡‘"}
];

const TAGS_CLASS = [ // 6
  {label:"å¯’é—¨å‡ºèº«",desc:"èµ„æºç¨€ç¼ºé©±åŠ¨çš„åŠªåŠ›æ¨¡å‹"},
  {label:"ä¸­äº§å®¶åº­",desc:"ç¨³å®šç»“æ„ä¸è·¯å¾„ä¾èµ–"},
  {label:"å¯Œè£•é˜¶å±‚",desc:"èµ„æºå†—ä½™ä¸æœºä¼šçª—å£"},
  {label:"ä¹¡é•‡èƒŒæ™¯",desc:"ç†Ÿäººç¤¾ä¼šä¸ç¨³æ€ä»·å€¼"},
  {label:"éƒ½å¸‚å®¶åº­",desc:"å¼€æ”¾ç½‘ç»œä¸ç«äº‰å‹åŠ›"},
  {label:"ç§»æ°‘å®¶åº­",desc:"è·¨æ–‡åŒ–ä¸åŒè¯­ç¯å¢ƒ"}
];

const TAGS_CONSUME = [ // 40
  {label:"å¥¢ä¾ˆå“åå¥½",desc:"é€šè¿‡é«˜ç«¯æ¶ˆè´¹è¡¨è¾¾å“å‘³"},
  {label:"çŸ¥è¯†ä»˜è´¹",desc:"æŒç»­è®¢é˜…å­¦ä¹ ä¸è¯¾ç¨‹"},
  {label:"æç®€ä¸»ä¹‰",desc:"å‡å°‘å æœ‰ï¼Œå¼ºè°ƒåŠŸèƒ½"},
  {label:"å†²åŠ¨æ¶ˆè´¹",desc:"æƒ…ç»ªé©±åŠ¨çš„å³æ—¶è´­ä¹°"},
  {label:"äºŒæ‰‹å¾ªç¯",desc:"ç¯ä¿ä¸æ€§ä»·æ¯”å…¼é¡¾"},
  {label:"ç”µå­æ•°ç æ§",desc:"è¿½æ–°ç¡¬ä»¶ä¸å‚æ•°"},
  {label:"ä½“éªŒè‡³ä¸Š",desc:"æ—…è¡Œ/å±•è§ˆ/æ´»åŠ¨ä¼˜å…ˆ"},
  {label:"å®¶åº­å‹æ¶ˆè´¹",desc:"ä»¥å®¶äººéœ€æ±‚ä¸ºå…ˆ"},
  {label:"å¥åº·æŠ•å…¥",desc:"å¥èº«/ä½“æ£€/è¥å…»"},
  {label:"å®¡ç¾æŠ•å…¥",desc:"è‰ºæœ¯/å®¶å±…/è®¾è®¡"},
  {label:"å‚¨è“„ä¼˜å…ˆ",desc:"ä»¥å®‰å…¨æ„Ÿä¸ºå¯¼å‘"},
  {label:"æŠ•èµ„ä¼˜å…ˆ",desc:"ç†è´¢/è‚¡å€º/é‡åŒ–"},
  {label:"ç›²ç›’æ”¶è—",desc:"è¶£å‘³æ€§ä¸ç¨€ç¼ºæ€§"},
  {label:"å†…å®¹ä»˜è´¹",desc:"ä¼šå‘˜/ç‰ˆæƒ/å»å¹¿å‘Š"},
  {label:"æ¸¸æˆæ°ªé‡‘",desc:"è™šæ‹Ÿç‰©å“ä¸ç«æŠ€"},
  {label:"ç›´æ’­æ‰“èµ",desc:"ç¤¾äº¤å›é¦ˆä¸æƒ…ç»ªæ¶ˆè´¹"},
  {label:"ç»¿è‰²æ¶ˆè´¹",desc:"å¯æŒç»­ä¸ä½ç¢³åå¥½"},
  {label:"å“ç‰Œå¿ è¯š",desc:"é•¿æœŸå•ä¸€å“ç‰Œåå¥½"},
  {label:"å›½äº§åå¥½",desc:"æœ¬åœŸå“ç‰Œæ”¯æŒ"},
  {label:"å°ä¼—å“ç‰Œ",desc:"ä¸ªæ€§è¡¨è¾¾"},
  {label:"å¤§ç‰Œåˆšéœ€",desc:"å¤´éƒ¨å“ç‰Œåˆšéœ€"},
  {label:"è®¢é˜…ç»æµ",desc:"SaaS/ä¼šå‘˜/è‡ªåŠ¨ç»­è´¹"},
  {label:"å›¢è´­æ‹¼å•",desc:"ç¤¾äº¤ä¸æ€§ä»·æ¯”"},
  {label:"ä¹°èœè¾¾äºº",desc:"å®¶åº­æ€§ä»·æ¯”ä¼˜åŒ–"},
  {label:"å¤–å–é‡åº¦",desc:"ä¾¿åˆ©ä¼˜å…ˆ"},
  {label:"å±…å®¶å›¤è´§",desc:"å®‰å…¨æ„Ÿä¸è§„åˆ’"},
  {label:"æµ·æ·˜å¸¸å®¢",desc:"å…¨çƒè´­ä¸å·®å¼‚åŒ–"},
  {label:"çº¿ä¸‹ä½“éªŒæ´¾",desc:"å®ä½“è§¦æ„Ÿä¸ç¤¾äº¤"},
  {label:"çº¿ä¸Šæ•ˆç‡æ´¾",desc:"æ—¶é—´æˆæœ¬ä¼˜å…ˆ"},
  {label:"æ‰‹ä½œææ–™",desc:"DIY åˆ›é€ æ€§æ¶ˆè´¹"},
  {label:"æ‘„å½±å™¨æ",desc:"ç”»è´¨ä¸è®°å½•åå¥½"},
  {label:"éœ²è¥è£…å¤‡",desc:"æˆ·å¤–ä½“éªŒ"},
  {label:"ä¹å™¨è´­ç½®",desc:"éŸ³ä¹è¡¨è¾¾"},
  {label:"å® ç‰©å¼€é”€",desc:"é™ªä¼´ä¸è´£ä»»"},
  {label:"äº²å­æ•™è‚²",desc:"é•¿çº¿æŠ•å…¥"},
  {label:"åŒ»ç¾æŠ¤è‚¤",desc:"è‡ªæˆ‘å½¢è±¡ç®¡ç†"},
  {label:"é¤é¥®æ¢ç´¢",desc:"å£å‘³ä¸ç¤¾äº¤"},
  {label:"å‡ºè¡Œå‡çº§",desc:"èˆ’é€‚/æ•ˆç‡"},
  {label:"ç¤¼ç‰©ç¤¾äº¤",desc:"å…³ç³»ç»´æŠ¤"},
  {label:"ç¤¾ç¾¤å›¢è´¹",desc:"åœˆå±‚å‚ä¸"}
];

const TAGS_SOCIAL = [ // 50
  {label:"ç¾¤èŠä¸»å¯¼è€…",desc:"ç»„ç»‡è¯é¢˜ä¸èŠ‚å¥"},
  {label:"å€¾å¬è€…",desc:"ä½å£°é‡é«˜å…±æƒ…"},
  {label:"æ®µå­æ‰‹",desc:"å¹½é»˜é©±åŠ¨è¿æ¥"},
  {label:"ç¤¾äº¤å›é¿",desc:"èƒ½é‡ä¿æŠ¤ä¸é€€ç¼©"},
  {label:"æ’®åˆè€…",desc:"ç‰µçº¿æ­æ¡¥"},
  {label:"æ„è§é¢†è¢–",desc:"è§‚ç‚¹å¤–æº¢å½±å“"},
  {label:"å’Œäº‹ä½¬",desc:"ç¼“å†²å†²çª"},
  {label:"æ‰¹åˆ¤è€…",desc:"æŒ‘é”™ä¸æ ¡æ­£"},
  {label:"å…±æƒ…è€…",desc:"æƒ…ç»ªå®¹å™¨"},
  {label:"æ‰§è¡Œè€…",desc:"è½åœ°æ¨è¿›"},
  {label:"å‡èšè€…",desc:"ç»´æŠ¤ç¾¤å†…çº½å¸¦"},
  {label:"ç ´å†°è€…",desc:"å¿«é€Ÿæ‰“é€šé™Œç”Ÿæ„Ÿ"},
  {label:"è§‚å¯Ÿè€…",desc:"ä¿¡æ¯å¸æ”¶ä¸åˆ¤æ–­"},
  {label:"è®°å½•è€…",desc:"æ€»ç»“ä¸ç•™ç—•"},
  {label:"åˆ†äº«è€…",desc:"èµ„æ–™/èµ„æºåˆ†å‘"},
  {label:"å‚¬åŒ–è€…",desc:"ä¿ƒæˆè¡ŒåŠ¨"},
  {label:"æŒ‘æˆ˜è€…",desc:"é€†å‘æ€ç»´"},
  {label:"ç¨³å‹å™¨",desc:"ç¨³å®šç¾¤æƒ…ç»ª"},
  {label:"äººè„‰æ‹“å±•è€…",desc:"å¼±è¿æ¥æ‰©å¼ "},
  {label:"ç¤¾ç¾¤ç®¡ç†å‘˜",desc:"ç§©åºä¸è§„èŒƒ"},
  {label:"è¯é¢˜æ²‰æµ¸è€…",desc:"é«˜é¢‘äº’åŠ¨"},
  {label:"æ½œæ°´è€…",desc:"ä½é¢‘å‚ä¸"},
  {label:"ç‹¬ç«‹è¡ŒåŠ¨è€…",desc:"åå•å…µä½œæˆ˜"},
  {label:"å›¢é˜Ÿåä½œè€…",desc:"åå›¢é˜Ÿåˆå¥"},
  {label:"è·¨åœˆè¿æ¥è€…",desc:"å¼‚è´¨ç¾¤ä½“æ¡¥æ¢"},
  {label:"ç¤¼è²Œå‹ç¤¾äº¤",desc:"å½¢å¼æ€§ç»´ç³»"},
  {label:"åŠŸåˆ©å‹ç¤¾äº¤",desc:"ç›®æ ‡å¯¼å‘"},
  {label:"æƒ…æ„Ÿå‹ç¤¾äº¤",desc:"å…³ç³»å¯¼å‘"},
  {label:"çŸ¥è¯†å‹ç¤¾äº¤",desc:"å†…å®¹å¯¼å‘"},
  {label:"ä»·å€¼è§‚å®ˆæŠ¤è€…",desc:"è¾¹ç•Œä¸åŸåˆ™"},
  {label:"å¼€æ”¾åŒ…å®¹è€…",desc:"å°Šé‡å·®å¼‚"},
  {label:"è‡ªæˆ‘è¡¨è¾¾è€…",desc:"è¡¨è¾¾æ¬²å¼º"},
  {label:"æ²‰é»˜å¯¡è¨€è€…",desc:"è¡¨è¾¾æ¬²å¼±"},
  {label:"ç›´çƒæ²Ÿé€šè€…",desc:"ä½ä¿®é¥°è¡¨è¾¾"},
  {label:"é«˜æƒ…å•†æ²Ÿé€šè€…",desc:"é«˜åŒç†æ²Ÿé€š"},
  {label:"å³å…´ç¤¾äº¤è€…",desc:"éšæ€§å‚ä¸"},
  {label:"ç­–åˆ’å‹ç¤¾äº¤è€…",desc:"é¢„æ¡ˆä¸ç»„ç»‡"},
  {label:"çº¿ä¸Šç¤¾äº¤è€…",desc:"åçº¿ä¸Šäº’åŠ¨"},
  {label:"çº¿ä¸‹ç¤¾äº¤è€…",desc:"åçº¿ä¸‹èšä¼š"},
  {label:"é•¿æœŸå…³ç³»ç»´æŠ¤è€…",desc:"æ·±å…³ç³»ç»è¥"},
  {label:"çŸ­æœŸå…³ç³»æ”¶é›†è€…",desc:"å¹¿æ’’ç½‘"},
  {label:"é«˜å¼ºåº¦ç¤¾äº¤è€…",desc:"é«˜é¢‘æ›å…‰"},
  {label:"ä½å¼ºåº¦ç¤¾äº¤è€…",desc:"ä½é¢‘éœ²é¢"},
  {label:"åŒæ¸©å±‚ç¤¾äº¤",desc:"ä»·å€¼è§‚ä¸€è‡´"},
  {label:"å¤šæ ·åŒ–ç¤¾äº¤",desc:"å¤šå…ƒäººç¾¤"},
  {label:"è®®ç¨‹æ§",desc:"ä¼šè®®æ¨åŠ¨"},
  {label:"æ‰“æ–­å‹è¡¨è¾¾",desc:"é«˜å†²çªé£é™©"},
  {label:"è½®åˆ°å¼è¡¨è¾¾",desc:"ç§©åºæ„è¯†å¼º"},
  {label:"å–„äºæ±‚åŠ©è€…",desc:"ä½æˆæœ¬æ±‚åŠ©"},
  {label:"ä¹äºåŠ©äººè€…",desc:"èµ„æºè¾“å‡º"}
];

const TAGS_TIME = [ // 36
  {label:"æ™¨å‹äºº",desc:"æ¸…æ™¨é«˜æ•ˆ"},
  {label:"å¤œé—´æ´»è·ƒ",desc:"å¤œæ™šé«˜æ•ˆ"},
  {label:"å›ºå®šä½œæ¯",desc:"èŠ‚å¾‹ç¨³å®š"},
  {label:"ç¢ç‰‡åŒ–æ—¶é—´",desc:"çŸ­æ—¶åˆ‡ç‰‡"},
  {label:"æ·±åº¦å·¥ä½œå—",desc:"é•¿æ—¶æ— æ‰“æ‰°"},
  {label:"å¤šçº¿ç¨‹åˆ‡æ¢",desc:"é¢‘ç¹ä¸Šä¸‹æ–‡"},
  {label:"å‘¨æœ«å†²åˆº",desc:"é›†ä¸­æ”»åš"},
  {label:"åˆåä½è°·",desc:"èŠ‚å¾‹è¯†åˆ«"},
  {label:"ä¼šè®®å¯†é›†",desc:"åä½œæ—¶é—´å¤š"},
  {label:"é€šå‹¤é•¿",desc:"è·¯ä¸Šæ—¶é—´å¤š"},
  {label:"å·®æ—…é¢‘ç¹",desc:"ç©ºé—´åˆ‡æ¢"},
  {label:"å±…å®¶åŠå…¬",desc:"åœºæ™¯ç¨³å®š"},
  {label:"åŠå…¬å®¤åŠå…¬",desc:"å³æ—¶åä½œ"},
  {label:"è¿åŠ¨å›ºå®šæ—¶æ®µ",desc:"ä½“èƒ½èŠ‚å¾‹"},
  {label:"å­¦ä¹ å›ºå®šæ—¶æ®µ",desc:"è®¤çŸ¥èŠ‚å¾‹"},
  {label:"å®¶åº­æ—¶é—´ä¼˜å…ˆ",desc:"äº²å­/ç…§æŠ¤"},
  {label:"ç¤¾äº¤æ—¶é—´å›ºå®š",desc:"å®šæœŸèšä¼š"},
  {label:"åˆ›ä½œæ—¶é—´å›ºå®š",desc:"è¾“å‡ºä¹ æƒ¯"},
  {label:"å¨±ä¹æ—¶é—´å›ºå®š",desc:"æ¢å¤ä¸å¥–åŠ±"},
  {label:"åˆç¡ä¹ æƒ¯",desc:"æ¢å¤ç²¾åŠ›"},
  {label:"æ—©èµ·é˜…è¯»",desc:"è¾“å…¥ä¼˜å…ˆ"},
  {label:"æ™šé—´å¤ç›˜",desc:"åæ€æ€»ç»“"},
  {label:"æ¸…æ™¨é‚®ä»¶",desc:"æ²Ÿé€šå‰ç½®"},
  {label:"å¤œé—´ç¼–ç ",desc:"å®‰é™ç”Ÿäº§"},
  {label:"é”™å³°ä½œæ¯",desc:"å¼‚æ­¥ååŒ"},
  {label:"å›ºå®šç•ªèŒ„é’Ÿ",desc:"èŠ‚å¾‹å·¥å…·"},
  {label:"æ— é—¹é’Ÿè‡ªç„¶é†’",desc:"èº«å¿ƒèŠ‚å¾‹"},
  {label:"å‡Œæ™¨çµæ„Ÿé«˜å‘",desc:"åˆ›é€ çª—å£"},
  {label:"å‘¨ä¸‰ä½å³°",desc:"ä¸­å‘¨ç–²åŠ³"},
  {label:"å‘¨ä¸€é«˜å‹",desc:"å¯åŠ¨æˆæœ¬"},
  {label:"å‘¨äº”æ”¾æ¾",desc:"æ¢å¤çª—å£"},
  {label:"æ¸…æ™¨é”»ç‚¼",desc:"è‡ªå¾‹å¼ºåŒ–"},
  {label:"å®æ—¶å“åº”",desc:"é«˜å¯ç”¨æ€§"},
  {label:"å»¶è¿Ÿå“åº”",desc:"æ·±åº¦ä¼˜å…ˆ"},
  {label:"å›ºå®šé™é»˜æ—¶æ®µ",desc:"å±è”½æ‰“æ‰°"},
  {label:"å®¶åº­æ™šé¤å›ºå®š",desc:"å…³ç³»ç»´æŠ¤"},
  {label:"æ—©ç¡æ—©èµ·",desc:"ç¨³æ€èŠ‚å¾‹"}
];

const TAGS_DBL = [ // æ•°å­—è‚¢ä½“è¯­è¨€ 50
  {label:"ç‚¹èµç‹‚é­”",desc:"é«˜é¢‘ç‚¹èµä¸è½»äº’åŠ¨"},
  {label:"å·²è¯»ä¸å›",desc:"ä½åé¦ˆé«˜é˜…è¯»"},
  {label:"é•¿æ–‡å…š",desc:"ç»“æ„åŒ–é•¿æ–‡æœ¬"},
  {label:"è¯­éŸ³æ¶ˆæ¯åå¥½",desc:"å£è¿°è¡¨è¾¾"},
  {label:"è¡¨æƒ…åŒ…è¾¾äºº",desc:"æƒ…ç»ªå¯è§†åŒ–"},
  {label:"æ’¤å›é¢‘ç¹",desc:"è¡¨è¾¾è°¨æ…/åæ‚”"},
  {label:"ç§’å›ä¹ æƒ¯",desc:"å³æ—¶åé¦ˆ"},
  {label:"å»¶è¿Ÿå›å¤",desc:"å¼‚æ­¥èŠ‚å¥"},
  {label:"æ·±å¤œå‘è¨€",desc:"å¤œé—´æ´»è·ƒ"},
  {label:"ç™½å¤©æ²‰é»˜",desc:"å·¥ä½œæ—¶æ®µä¸“æ³¨"},
  {label:"å¼•ç”¨å›å¤",desc:"ç»“æ„æ¸…æ™°"},
  {label:"@å…¨ä½“åå¥½",desc:"æ•ˆç‡/å†’çŠ¯è¾¹ç•Œ"},
  {label:"æ¶ˆæ¯å·²é€è¾¾æ§",desc:"ç¡®è®¤åå¥½"},
  {label:"æ–‡ä»¶å‘½åè§„èŒƒ",desc:"ç§©åºä¸å¯æ£€ç´¢"},
  {label:"ç‰ˆæœ¬æ§åˆ¶æ„è¯†",desc:"å˜æ›´å¯è¿½æº¯"},
  {label:"ç¬”è®°é“¾æ¥å…š",desc:"çŸ¥è¯†å›¾è°±æ„è¯†"},
  {label:"æ—¥å†é‚€è¯·è€…",desc:"å–„ç”¨ååŒå·¥å…·"},
  {label:"æ—¥ç¨‹ä¸´æ—¶æ”¹åŠ¨",desc:"çµæ´»/ä¸ç¨³å®š"},
  {label:"åœ¨çº¿çŠ¶æ€é•¿äº®",desc:"é•¿æ—¶åœ¨çº¿"},
  {label:"å…æ‰“æ‰°å¸¸å¼€",desc:"å‡å°‘æ‰“æ‰°"},
  {label:"å¼€ä¼šæ‘„åƒå¤´å¸¸å¼€",desc:"é€æ˜ä¸åœ¨åœºæ„Ÿ"},
  {label:"å¼€ä¼šé™éŸ³å¸¸å¼€",desc:"é™ä½å™ªéŸ³"},
  {label:"ä¼šè®®çºªè¦è¾“å‡º",desc:"ä¿¡æ¯å¤ç”¨"},
  {label:"ä»»åŠ¡çœ‹æ¿ä¹ æƒ¯",desc:"æµç¨‹åŒ–ç®¡ç†"},
  {label:"å¤šäººåä½œæ–‡æ¡£",desc:"å®æ—¶å…±åˆ›"},
  {label:"æ¨¡ç‰ˆåŒ–å¤ç”¨",desc:"æŠ½è±¡ä¸æ•ˆç‡"},
  {label:"æˆªå›¾æ³¨é‡Šæ´¾",desc:"è§†è§‰æ²Ÿé€š"},
  {label:"å›¾è¡¨åå¥½è€…",desc:"æ•°æ®è¡¨è¾¾"},
  {label:"ä»£ç ç‰‡æ®µå…±äº«",desc:"æŠ€æœ¯æ²Ÿé€š"},
  {label:"çŸ­å¥è¦ç‚¹é£æ ¼",desc:"ä¿¡æ¯å¯†åº¦é«˜"},
  {label:"é—®é¢˜å¯¼å‘é£æ ¼",desc:"ç›´è¾¾ä¸»é¢˜"},
  {label:"è‡´è°¢/åé¦ˆä¹ æƒ¯",desc:"å…³ç³»ç»´æŠ¤"},
  {label:"è¡¨å†³æŠ•ç¥¨ç§¯æ",desc:"å‚ä¸åº¦é«˜"},
  {label:"ç¾¤é‡Œå°‘è¯´è¯",desc:"èŠ‚èƒ½ç­–ç•¥"},
  {label:"è‡ªå»ºçŸ¥è¯†åº“",desc:"é•¿æœŸç§¯ç´¯"},
  {label:"æ”¶è—å¤¹åˆ†é—¨åˆ«ç±»",desc:"ä¿¡æ¯ç®¡ç†"},
  {label:"è‡ªåŠ¨åŒ–è„šæœ¬åå¥½",desc:"æµç¨‹è‡ªåŠ¨åŒ–"},
  {label:"å¿«æ·é”®é‡åº¦",desc:"æ•ˆç‡è‡³ä¸Š"},
  {label:"äº‘ç«¯åŒæ­¥åå¥½",desc:"å¤šç«¯ä¸€è‡´"},
  {label:"éšç§è®¾ç½®æ•æ„Ÿ",desc:"è¾¹ç•Œä¸å®‰å…¨"},
  {label:"å°å·è§‚å¯Ÿ/åˆ†èº«",desc:"é£é™©æ§åˆ¶"},
  {label:"ä¸»é¢˜çš®è‚¤ç»Ÿä¸€",desc:"å®¡ç¾ä¸€è‡´æ€§"},
  {label:"æµ…è‰²æ¨¡å¼æ´¾",desc:"è§†è§‰åå¥½"},
  {label:"æ·±è‰²æ¨¡å¼æ´¾",desc:"è§†è§‰åå¥½"},
  {label:"è®¾å¤‡å¤šç«¯åˆ‡æ¢",desc:"ç§»åŠ¨åŠå…¬"},
  {label:"æ”¶è—ä¸å¤çœ‹",desc:"å›¤ç§¯ä¿¡æ¯"},
  {label:"å®šæœŸæ¸…ç†æ”¶ä»¶ç®±",desc:"æ•´æ´ä¸æŒæ§"},
  {label:"ç¾¤æ¶ˆæ¯æŠ˜å ",desc:"é™å™ªç­–ç•¥"},
  {label:"åˆ†ç»„é€šçŸ¥ç­–ç•¥",desc:"ä¼˜å…ˆçº§æ„è¯†"},
  {label:"æ•æ·è¿­ä»£æ—¥å¿—",desc:"èŠ‚å¥ä¸é€æ˜"},
  {label:"æ²‰æµ¸å†™ä½œæ¨¡å¼",desc:"ä¸“æ³¨è¾“å‡º"}
];

/* æ±‡æ€»è‡³ 200 ä¸ª */
const LIB = {
  "å…³é”®äº‹ä»¶": TAGS_EVENTS,
  "ç¤¾ä¼šé˜¶å±‚": TAGS_CLASS,
  "æ¶ˆè´¹å°è®°": TAGS_CONSUME,
  "ç¤¾äº¤æŒ‡çº¹": TAGS_SOCIAL,
  "æ—¶é—´åˆ†é…": TAGS_TIME,
  "æ•°å­—è‚¢ä½“è¯­è¨€": TAGS_DBL
};
const TOTAL_COUNT = Object.values(LIB).reduce((a,arr)=>a+arr.length,0); // =200

/* ================== è§„åˆ™æ˜ å°„å™¨ï¼šæ ‡ç­¾ â†’ Big5 Î”å‘é‡ ==================
   è¿”å› [dO,dC,dE,dA,dN]ï¼Œå»ºè®®èŒƒå›´çº¦ [-10,+10]ï¼›å…³é”®äº‹ä»¶å¯ç¨å¤§ã€‚
   ä½ å¯ä»¥æŒ‰éœ€è¦åœ¨æ­¤è¿›ä¸€æ­¥ç²¾ç»†åŒ–ã€‚
===================================================================== */
function deltaForTag(category, label){
  // åŸºç¡€
  let O=0,C=0,E=0,A=0,N=0;

  // â€”â€” å…³é”®äº‹ä»¶ï¼ˆæ›´å¼ºçš„å¹…åº¦ï¼‰ â€”â€”
  if(category==="å…³é”®äº‹ä»¶"){
    const m = {
      "é‡å¤§å¤±è´¥":[ 0,-2,-2,-2,+8],
      "çªé‡è´µäºº":[+2,+2,+2,+3,-1],
      "ç§»æ°‘ç»å†":[+6, 0,+3,+2,+3],
      "è‡ªç„¶ç¾å®³":[ 0, 0, 0,+1,+6],
      "é‡å¤§ç–¾ç—…":[ 0,-2, 0, 0,+8],
      "æ„å¤–è´¢å¯Œ":[+2, 0,+2,-2,+2],
      "åˆ›ä¸šå¤±è´¥":[+1,-1,-1,-1,+7],
      "å…¬å¼€æ¼”è®²æˆåŠŸ":[ 0, 0,+5, 0,-1],
      "é•¿æœŸå¼‚åœ°æ‹":[ 0, 0, 0,+1,+4],
      "å‡å­¦è·³çº§":[+2,+2, 0, 0, 0],
      "å®¶åº­å˜æ•…":[ 0,+1,-2,-1,+6],
      "èŒä¸šè½¬è¡Œ":[+4, 0, 0, 0,+2],
      "é•¿é€”å¾’æ­¥":[ 0,+2, 0, 0,+1],
      "å¿—æ„¿è€…æœåŠ¡":[ 0, 0, 0,+5, 0],
      "ç«æŠ€å¤ºå† ":[ 0,+4,+2, 0,-2],
      "å­¦æœ¯ä¸ç«¯å†²å‡»":[-2, 0,-2,-3,+7],
      "è€ƒè¯•å¤±åˆ©":[ 0,-1,-1,-1,+5],
      "äº²å¯†å…³ç³»ç ´è£‚":[ 0, 0,-2,-2,+6]
    };
    if(m[label]) [O,C,E,A,N] = m[label];
  }

  // â€”â€” ç¤¾ä¼šé˜¶å±‚ â€”â€”
  if(category==="ç¤¾ä¼šé˜¶å±‚"){
    const m = {
      "å¯’é—¨å‡ºèº«":[+1,+3, 0, 0,+2],
      "ä¸­äº§å®¶åº­":[ 0,+2, 0,+1, 0],
      "å¯Œè£•é˜¶å±‚":[+1, 0,+2,-1, 0],
      "ä¹¡é•‡èƒŒæ™¯":[-1, 0,-1,+1, 0],
      "éƒ½å¸‚å®¶åº­":[+2,+1,+1, 0,+1],
      "ç§»æ°‘å®¶åº­":[+3, 0,+1,+1,+2]
    };
    if(m[label]) [O,C,E,A,N] = m[label];
  }

  // â€”â€” æ¶ˆè´¹å°è®°ï¼ˆå…³é”®è¯è§„åˆ™ï¼‰ â€”â€”
  if(category==="æ¶ˆè´¹å°è®°"){
    if(/çŸ¥è¯†|å­¦ä¹ |å†…å®¹|é˜…è¯»|æ‰‹ä½œ|æ‘„å½±|ä¹å™¨/.test(label)) O+=3;
    if(/æç®€|å‚¨è“„|äºŒæ‰‹|è§„èŒƒ|è®¢é˜…|å›¢è´­|ä¹°èœ|å›¤è´§/.test(label)) C+=2;
    if(/å†²åŠ¨|æ°ªé‡‘|æ‰“èµ/.test(label)) { E+=2; N+=2; C-=2; }
    if(/ç»¿è‰²|å¯æŒç»­/.test(label)) { O+=2; A+=1; }
    if(/å®¶åº­|äº²å­/.test(label)) { A+=2; C+=1; }
    if(/å“ç‰Œå¿ è¯š|å¤§ç‰Œåˆšéœ€/.test(label)) { C+=2; O-=1; }
    if(/å°ä¼—|å®¡ç¾|è‰ºæœ¯/.test(label)) { O+=3; }
    if(/çº¿ä¸Š|æ•ˆç‡|è®¢é˜…|è‡ªåŠ¨/.test(label)) { C+=2; }
    if(/çº¿ä¸‹|ä½“éªŒ|é¤é¥®|æ—…è¡Œ|éœ²è¥/.test(label)) { E+=2; O+=2; }
    if(/å¥åº·|ä½“æ£€|å¥èº«/.test(label)) { C+=2; N-=1; }
  }

  // â€”â€” ç¤¾äº¤æŒ‡çº¹ â€”â€”
  if(category==="ç¤¾äº¤æŒ‡çº¹"){
    if(/ä¸»å¯¼|æ„è§é¢†è¢–|è®®ç¨‹æ§|æŒ‘æˆ˜è€…/.test(label)) { E+=5; A-=2; C+=1; }
    if(/å’Œäº‹ä½¬|ç¨³å‹å™¨|é«˜æƒ…å•†/.test(label)) { A+=5; N-=1; }
    if(/ç¤¾äº¤å›é¿|æ½œæ°´|æ²‰é»˜å¯¡è¨€/.test(label)) { E-=6; N+=3; }
    if(/ç ´å†°|åˆ†äº«|å‡èš|äººè„‰|è·¨åœˆ/.test(label)) { E+=4; O+=2; }
    if(/è®°å½•è€…|çŸ¥è¯†|æ€»ç»“|è½®åˆ°å¼/.test(label)) { C+=2; E-=1; }
    if(/åŠŸåˆ©|ç›´çƒ|æ‰“æ–­/.test(label)) { A-=3; E+=1; }
    if(/å¼€æ”¾åŒ…å®¹/.test(label)) { A+=3; O+=2; }
    if(/ç‹¬ç«‹è¡ŒåŠ¨è€…/.test(label)) { E-=2; C+=1; }
    if(/å›¢é˜Ÿåä½œ|åä½œè€…/.test(label)) { A+=2; E+=1; }
    if(/é«˜å¼ºåº¦/.test(label)) { E+=3; N+=1; }
    if(/ä½å¼ºåº¦/.test(label)) { E-=3; }
  }

  // â€”â€” æ—¶é—´åˆ†é… â€”â€”
  if(category==="æ—¶é—´åˆ†é…"){
    if(/æ™¨|æ—©èµ·|æ¸…æ™¨/.test(label)) { C+=3; N-=1; }
    if(/å¤œ|å‡Œæ™¨/.test(label)) { O+=2; C-=2; }
    if(/å›ºå®š|è§„å¾‹|ç•ªèŒ„|é™é»˜|æ—¥å†/.test(label)) { C+=4; N-=1; }
    if(/ç¢ç‰‡|å¤šçº¿ç¨‹|å®æ—¶/.test(label)) { C-=2; N+=1; }
    if(/æ·±åº¦å·¥ä½œ/.test(label)) { C+=4; N-=1; }
    if(/å®¶åº­|ç¤¾äº¤/.test(label)) { A+=2; }
    if(/å·®æ—…/.test(label)) { O+=2; E+=1; }
  }

  // â€”â€” æ•°å­—è‚¢ä½“è¯­è¨€ â€”â€”
  if(category==="æ•°å­—è‚¢ä½“è¯­è¨€"){
    if(/å·²è¯»ä¸å›|å»¶è¿Ÿ|å…æ‰“æ‰°|é™éŸ³/.test(label)) { E-=2; C+=1; }
    if(/ç§’å›|åœ¨çº¿çŠ¶æ€/.test(label)) { E+=3; }
    if(/é•¿æ–‡|å¼•ç”¨|çºªè¦|ç‰ˆæœ¬|çœ‹æ¿|æ¨¡ç‰ˆ|å‘½å/.test(label)) { C+=4; }
    if(/è¡¨æƒ…åŒ…|å›¾è¡¨|æˆªå›¾/.test(label)) { O+=2; E+=1; }
    if(/éšç§|å°å·/.test(label)) { N+=2; A-=1; }
    if(/è‡´è°¢|æŠ•ç¥¨|å¤šäººåä½œ/.test(label)) { A+=3; }
    if(/è‡ªåŠ¨åŒ–|å¿«æ·é”®|äº‘ç«¯/.test(label)) { C+=2; O+=1; }
    if(/æ·±å¤œå‘è¨€/.test(label)) { O+=1; C-=1; }
  }

  return [O,C,E,A,N];
}

/* ================== UI æ¸²æŸ“ ================== */
const selInd = document.getElementById('industry');
const selPos = document.getElementById('position');
selInd.innerHTML = INDUSTRIES.map(x=>`<option>${x}</option>`).join('');
selPos.innerHTML = POSITIONS.map(x=>`<option>${x}</option>`).join('');
const wIEl=document.getElementById('wIndustry'), wPEl=document.getElementById('wPosition');
const wIVal=document.getElementById('wIndustryVal'), wPVal=document.getElementById('wPositionVal');
wIEl.addEventListener('input',()=>wIVal.textContent=wIEl.value);
wPEl.addEventListener('input',()=>wPVal.textContent=wPEl.value);

/* æ ‡ç­¾åº“æ¸²æŸ“ï¼ˆå¸¦æœç´¢ï¼‰ */
const libBox = document.getElementById('lib');
const totalCountEl = document.getElementById('totalCount');
const visibleCountEl = document.getElementById('visibleCount');
totalCountEl.textContent = TOTAL_COUNT;

function renderLibrary(filter=""){
  libBox.innerHTML="";
  let visible=0;
  Object.keys(LIB).forEach(cat=>{
    const list = LIB[cat].filter(t=>{
      if(!filter) return true;
      return t.label.includes(filter) || (t.desc && t.desc.includes(filter));
    });
    if(!list.length) return;
    const h = document.createElement('div');
    h.className='cat'; h.textContent=cat; libBox.appendChild(h);
    list.forEach(t=>{
      visible++;
      const box = document.createElement('div');
      box.className='tag';
      const id = `${cat}__${t.label}`;
      box.innerHTML = `
        <h4>${t.label} <span class="tiny">ï¼ˆ${cat}ï¼‰</span></h4>
        <div class="desc">${t.desc||""}</div>
        <div class="ctrl">
          <label>å½±å“æƒé‡</label>
          <input type="range" min="1" max="10" value="5" id="w_${id}"/>
          <span class="tiny" id="wv_${id}">5</span>
          <button data-cat="${cat}" data-lab="${t.label}">åŠ å…¥</button>
        </div>`;
      libBox.appendChild(box);
      const r = box.querySelector(`#w_${id}`), v = box.querySelector(`#wv_${id}`);
      r.addEventListener('input',()=>{ v.textContent=r.value; });
      box.querySelector('button').addEventListener('click', ()=>{
        upsertSelected({category:cat,label:t.label,desc:t.desc,weight:parseInt(r.value,10)});
      });
    });
  });
  visibleCountEl.textContent = visible;
}
renderLibrary();
document.getElementById('kw').addEventListener('input', e=>renderLibrary(e.target.value.trim()));
document.getElementById('clearFilter').addEventListener('click', ()=>{ document.getElementById('kw').value=""; renderLibrary(""); });

/* ================== å·²é€‰ç®¡ç† ================== */
const state = { selected: [] };
function upsertSelected(item){
  const i = state.selected.findIndex(x=>x.category===item.category && x.label===item.label);
  if(i>=0) state.selected[i]=item; else state.selected.push(item);
  renderSelected();
}
function renderSelected(){
  const box=document.getElementById('selected');
  if(!state.selected.length){ box.innerHTML='<div class="tiny">æš‚æ— é€‰æ‹©</div>'; return; }
  box.innerHTML = state.selected.map((s,i)=>`
    <div class="item">
      <div class="meta">
        <div><strong>${s.label}</strong> <span class="pill">${s.category}</span></div>
        <div class="tiny">${s.desc||""}</div>
        <div class="row" style="margin-top:6px">
          <label>æƒé‡</label>
          <input type="range" min="1" max="10" value="${s.weight||5}" oninput="state.selected[${i}].weight=parseInt(this.value,10)"/>
          <span class="tiny">${s.weight||5}</span>
        </div>
      </div>
      <button class="rm" onclick="state.selected.splice(${i},1);renderSelected()">ç§»é™¤</button>
    </div>
  `).join('');
}
renderSelected();

/* ================== è®¡ç®—ï¼šç¯å¢ƒå¤§äº” & å››æ¶²è´¨ ================== */
function clamp01(x){ return Math.max(0, Math.min(100, Math.round(x))); }
function addVec(a=[],b=[]){ return [ (a[0]||0)+(b[0]||0), (a[1]||0)+(b[1]||0), (a[2]||0)+(b[2]||0), (a[3]||0)+(b[3]||0), (a[4]||0)+(b[4]||0) ]; }

function weightedEnvBig5(){
  const baseline = [50,50,50,50,50];

  let acc=[0,0,0,0,0], wSum=0;

  // è¡Œä¸šï¼ˆå•é€‰ï¼‰
  const ind = selInd.value;
  const wI = parseInt(wIEl.value,10)||5;
  if(big5DeltaRole[ind]){ acc = addVec(acc, big5DeltaRole[ind].map(x=>x*wI)); wSum += wI; }

  // èŒä½ï¼ˆå•é€‰ï¼‰
  const pos = selPos.value;
  const wP = parseInt(wPEl.value,10)||5;
  if(big5DeltaRole[pos]){ acc = addVec(acc, big5DeltaRole[pos].map(x=>x*wP)); wSum += wP; }

  // å…¶ä»–æ ‡ç­¾ï¼ˆå¤šé€‰ï¼‰
  state.selected.forEach(s=>{
    const delta = deltaForTag(s.category, s.label);
    const w = parseInt(s.weight||5,10);
    acc = addVec(acc, delta.map(x=>x*w)); wSum += w;
  });

  const avg = wSum ? acc.map(x=>x/wSum) : [0,0,0,0,0];
  return baseline.map((b,i)=>clamp01(b + avg[i]));
}

function bigFiveToTemperaments([O,C,E,A,N]){
  const ES=100-N;
  let S=0.5*E+0.3*O+0.2*ES;
  let Ch=0.4*E+0.4*C-0.2*A+0.2*ES;
  let M=0.5*N+0.2*C-0.2*E+0.1*A;
  let P=0.4*A+0.3*ES+0.2*C-0.1*E;
  S=Math.max(0,S);Ch=Math.max(0,Ch);M=Math.max(0,M);P=Math.max(0,P);
  const sum=S+Ch+M+P || 1;
  return {å¤šè¡€è´¨:Math.round(S/sum*100),èƒ†æ±è´¨:Math.round(Ch/sum*100),æŠ‘éƒè´¨:Math.round(M/sum*100),ç²˜æ¶²è´¨:Math.round(P/sum*100)};
}

/* ================== ä¿å­˜å¹¶è·³è½¬ ================== */
document.getElementById('saveNext').addEventListener('click', ()=>{
  // æŠŠè¡Œä¸š/èŒä½ä¹Ÿå¹¶å…¥ selectedTagsï¼ˆæ³¨æ„ï¼šå®ƒä»¬æ˜¯å•é€‰ï¼Œå„è‡ªç‹¬ç«‹è®°å½•ï¼‰
  const selectedTags = [
    {label: selInd.value, category:"è¡Œä¸š", desc:"èŒä¸šè¡Œä¸šå•é€‰", weight: parseInt(wIEl.value,10)},
    {label: selPos.value, category:"èŒä½", desc:"èŒä¸šèŒä½å•é€‰", weight: parseInt(wPEl.value,10)},
    ...state.selected
  ];
  localStorage.setItem('selectedTags', JSON.stringify(selectedTags));

  const envBig5 = weightedEnvBig5();
  const envTemp = bigFiveToTemperaments(envBig5);
  localStorage.setItem('envScores', JSON.stringify(envBig5));
  localStorage.setItem('temperamentEnv', JSON.stringify(envTemp));

  window.location.assign('report.html');
});
</script>
</body>
</html>
